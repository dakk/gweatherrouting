app-id: io.github.dakk.gweatherrouting
runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
command: gweatherrouting
finish-args:
  - --share=network
  - --share=ipc
  - --filesystem=xdg-documents
  - --filesystem=xdg-download
  - --socket=fallback-x11
  - --socket=wayland


modules:

  - name: proj
    buildsystem: cmake-ninja
    config-opts:
      - -DBUILD_TESTING=OFF
      - -DCMAKE_BUILD_TYPE=Release
    sources:
      - type: archive
        url: https://download.osgeo.org/proj/proj-9.7.0.tar.gz
        sha256: 65705ecd987b50bf63e15820ce6bd17c042feaabda981249831bd230f6689709

  - name: geos
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DBUILD_TESTING=OFF
    sources:
      - type: archive
        url: http://download.osgeo.org/geos/geos-3.13.1.tar.bz2
        sha256: df2c50503295f325e7c8d7b783aca8ba4773919cde984193850cf9e361dfd28c
        x-checker-data:
          type: anitya
          project-id: 13493
          url-template: http://download.osgeo.org/geos/geos-$version.tar.bz2
          stable-only: true

  - name: swig
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app --no-deps swig-4.4.0-py3-none-manylinux_2_12_x86_64.manylinux2010_x86_64.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/18/12/1496d875e304f262c9284fd72714cdfa705064910d525174ef89887cbdf8/swig-4.4.0-py3-none-manylinux_2_12_x86_64.manylinux2010_x86_64.whl
        sha256: 55267923f99621c37a4979ec0db3592726906afaa9a1d441cd96229190aab3e4

  - name: json-c
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DBUILD_TESTING=OFF
      - -DCMAKE_POLICY_VERSION_MINIMUM=3.5
    sources:
      - type: git
        url: https://github.com/json-c/json-c
        tag: json-c-0.18-20240915
        commit: 41a55cfcedb54d9c1874f2f0eb07b504091d7e37
        x-checker-data:
          type: git
          tag-pattern: '^json-c-([\d.]+)-[\d]+$'          

  - name: libgeotiff
    buildsystem: autotools
    sources:
    - type: archive
      url: https://github.com/OSGeo/libgeotiff/releases/download/1.7.4/libgeotiff-1.7.4.tar.gz
      sha256: c598d04fdf2ba25c4352844dafa81dde3f7fd968daa7ad131228cd91e9d3dc47

  - bin-requirements.yaml 

  - name: gdal
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DBUILD_TESTING=OFF
      - -DBUILD_APPS=OFF
      - -DBUILD_PYTHON_BINDINGS=ON
      - -DBUILD_SHARED_LIBS=ON
      - -DGDAL_USE_INTERNAL_LIBS=OFF
      - -DGDAL_USE_TIFF_INTERNAL=ON
      - -DGDAL_USE_GEOTIFF_INTERNAL=ON
      - -DGDAL_USE_GEOS=ON
      - -DGDAL_USE_JSONC=ON
      - -DGDAL_USE_PROJ=ON
      - -DGDAL_USE_PYTHON=ON
    sources:
      - type: archive
        url: https://github.com/OSGeo/gdal/releases/download/v3.12.0/gdal-3.12.0.tar.gz
        sha256: 44c95baabe6c1a047c1ebe5043e38dd73e4936bc4c481db14efbfd03342eab73

  - name: osm-gps-map
    buildsystem: autotools
    config-opts:
      - --disable-debug
    sources:
      - type: git
        url: https://github.com/nzjrs/osm-gps-map.git
        commit: 639ea5e02d2cb47cbc15554d61b1ba6b0ee073b6
 
  - name: gweatherrouting
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --no-deps --prefix=/app --no-build-isolation .
      - install -Dm644 gweatherrouting/data/icon.png /app/share/icons/hicolor/256x256/apps/io.github.dakk.gweatherrouting.png
      - install -Dm644 tools/io.github.dakk.gweatherrouting.desktop /app/share/applications/io.github.dakk.gweatherrouting.desktop 
    cleanup:
      - /app/include
      - /app/lib/pkgconfig      
    sources:
      - type: archive
        url: https://github.com/dakk/gweatherrouting/archive/refs/tags/v0.2.2.tar.gz
        sha256: 94d33d5890d2fe43ba70a878430bb3586472f794cdbd8f349db4c4655daeb38c
